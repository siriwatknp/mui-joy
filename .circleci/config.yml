version: 2.1

parameters:
  should-run-e2e:
    type: boolean
    default: false
  playwright-base-url:
    type: string
    default: "https://playwright.dev"

jobs:
  Run-e2e:
    docker:
      - image: mcr.microsoft.com/playwright@sha256:f08e263c95e83334104e6e2fee047ad92062a03af6ae94c0f8686ba2b3014823
        environment:
          NODE_ENV: development # Needed if playwright is in `devDependencies`
    steps:
      - checkout
      - when:
          condition: << pipeline.parameters.should-run-e2e >>
          steps:
            - run:
                name: Install js dependencies
                command: yarn install --verbose
            - run:
                name: Run E2E tests
                command: yarn test:e2e
                environment:
                  PLAYWRIGHT_TEST_BASE_URL: << pipeline.parameters.playwright-base-url >>

workflows:
  version: 2
  Run-e2e:
    jobs:
      - Run-e2e
